#:import r src.utils.responsive
<FoodTrackScreen>:
    ResponsiveContainer:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: rgba('#bfc6e0')
            Rectangle:
                pos: self.pos
                size: self.size
        AppHeader:
            id: app_header
            title: "Food Tracking"
        ContentScroll:
            ContentSection:
                # Tab selection
                SectionHeader:
                    text: "Lookup Method"
                ContentCard:
                    MDBoxLayout:
                        orientation: "horizontal"
                        padding: [SP_SM, SP_SM]
                        spacing: SP_SM
                        size_hint_y: None
                        height: r.scale_dp(52)
                        
                        MDButton:
                            id: manual_tab
                            style: "elevated"
                            size_hint: (0.33, 1)
                            md_bg_color: rgba('#505CA9') if root.current_tab == 'manual' else rgba('#dadeed')
                            on_release: root.switch_tab('manual')
                            MDButtonText:
                                text: "Manual"
                                text_color: rgba('#ffffff') if root.current_tab == 'manual' else rgba('#202443')
                        
                        MDButton:
                            id: barcode_tab
                            style: "elevated"
                            size_hint: (0.33, 1)
                            md_bg_color: rgba('#505CA9') if root.current_tab == 'barcode' else rgba('#dadeed')
                            on_release: root.switch_tab('barcode')
                            MDButtonText:
                                text: "Barcode"
                                text_color: rgba('#ffffff') if root.current_tab == 'barcode' else rgba('#202443')
                        
                        MDButton:
                            id: camera_tab
                            style: "elevated"
                            size_hint: (0.33, 1)
                            md_bg_color: rgba('#505CA9') if root.current_tab == 'camera' else rgba('#dadeed')
                            on_release: root.switch_tab('camera')
                            MDButtonText:
                                text: "Camera"
                                text_color: rgba('#ffffff') if root.current_tab == 'camera' else rgba('#202443')
                
                # Manual Entry Tab Content
                MDBoxLayout:
                    id: manual_content
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    opacity: 1 if root.current_tab == 'manual' else 0
                    disabled: root.current_tab != 'manual'
                    
                    SectionHeader:
                        text: "Search Food Database"
                    ContentCard:
                        MDBoxLayout:
                            orientation: "vertical"
                            padding: [SP_MD, SP_MD]
                            spacing: SP_SM
                            
                            MDTextField:
                                id: food_search_input
                                hint_text: "Search for food..."
                                helper_text: "Enter food name to search database"
                                helper_text_mode: "on_focus"
                                mode: "filled"
                                line_color_focus: rgba('#008D36')
                                hint_text_color_focus: rgba('#008D36')
                                fill_color_normal: rgba('#dadeed')
                                fill_color_focus: rgba('#e9ebf5')
                                size_hint_y: None
                                height: r.scale_dp(56)
                                on_text: root.on_search_text(self.text)
                            
                            MDLabel:
                                text: "Type to search food items"
                                text_size: self.width, None
                                font_style: "Body"
                                theme_text_color: "Secondary"
                                size_hint_y: None
                                height: r.scale_dp(20)
                
                # Barcode Entry Tab Content
                MDBoxLayout:
                    id: barcode_content
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    opacity: 1 if root.current_tab == 'barcode' else 0
                    disabled: root.current_tab != 'barcode'
                    
                    SectionHeader:
                        text: "Barcode Lookup"
                    ContentCard:
                        MDBoxLayout:
                            orientation: "vertical"
                            padding: [SP_MD, SP_MD]
                            spacing: SP_SM
                            
                            MDTextField:
                                id: barcode_input
                                hint_text: "Enter barcode number"
                                helper_text: "Enter UPC/EAN barcode (8-13 digits)"
                                helper_text_mode: "on_focus"
                                mode: "filled"
                                line_color_focus: rgba('#008D36')
                                hint_text_color_focus: rgba('#008D36')
                                fill_color_normal: rgba('#dadeed')
                                fill_color_focus: rgba('#e9ebf5')
                                size_hint_y: None
                                height: r.scale_dp(56)
                                input_filter: "int"
                            
                            MDLabel:
                                size_hint_y: None
                                height: r.scale_dp(10)
                            
                            PrimaryButton:
                                size_hint: (None, None)
                                width: r.scale_dp(BTN_W_XL)
                                height: r.scale_dp(52)
                                pos_hint: {"center_x": 0.5}
                                on_release: root.lookup_barcode()
                                MDButtonIcon:
                                    icon: "barcode-scan"
                                    icon_color: CAL_YELLOW
                                MDButtonText:
                                    text: "Lookup"
                                    text_color: CAL_GREEN
                
                # Camera Scan Tab Content
                MDBoxLayout:
                    id: camera_content
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    opacity: 1 if root.current_tab == 'camera' else 0
                    disabled: root.current_tab != 'camera'
                    
                    SectionHeader:
                        text: "Camera Scanner"
                    ContentCard:
                        MDBoxLayout:
                            orientation: "vertical"
                            padding: [SP_MD, SP_MD]
                            spacing: SP_SM
                            size_hint_y: None
                            height: self.minimum_height
                            
                            MDBoxLayout:
                                id: camera_container
                                size_hint: (1, None)
                                height: r.scale_dp(200)
                                canvas.before:
                                    Color:
                                        rgba: rgba('#202443')
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                            
                            MDLabel:
                                text: "Point camera at barcode"
                                text_size: self.width, None
                                font_style: "Body"
                                theme_text_color: "Secondary"
                                halign: "center"
                                size_hint_y: None
                                height: r.scale_dp(20)
                
                # Results Display (shared across all tabs)
                SectionHeader:
                    text: "Product Information"
                ContentCard:
                    id: result_card
                    md_bg_color: CAL_BG_LIGHT
                    opacity: 1 if root.product_found else 0.5
                    MDBoxLayout:
                        orientation: "vertical"
                        padding: [SP_MD, SP_MD]
                        spacing: SP_XS
                        
                        MDLabel:
                            id: result_label
                            text: root.result_text
                            font_style: "Body"
                            theme_text_color: "Custom"
                            text_color: CAL_TEXT_DARK
                            size_hint_y: None
                            height: self.texture_size[1]
                        
                        MDLabel:
                            id: nutrition_info
                            text: ""
                            font_style: "Body"
                            theme_text_color: "Secondary"
                            size_hint_y: None
                            height: self.texture_size[1] if self.text else 0
                
                # Actions
                SectionHeader:
                    text: "Actions"
                ContentCard:
                    MDBoxLayout:
                        orientation: "horizontal"
                        padding: [SP_MD, SP_MD]
                        spacing: SP_SM
                        size_hint_y: None
                        height: r.scale_dp(52)
                        
                        MDButton:
                            style: "elevated"
                            size_hint: (0.5, 1)
                            md_bg_color: rgba('#505CA9')
                            on_release: root.record_to_caloriedb()
                            disabled: not root.product_found
                            MDButtonIcon:
                                icon: "database"
                                icon_color: CAL_YELLOW
                            MDButtonText:
                                text: "Record"
                                text_color: CAL_GREEN
                        
                        MDButton:
                            style: "outlined"
                            size_hint: (0.5, 1)
                            on_release: root.clear_results()
                            MDButtonIcon:
                                icon: "refresh"
                                icon_color: CAL_TEXT_DARK
                            MDButtonText:
                                text: "Clear"
                                text_color: CAL_TEXT_DARK
        PrimaryBottomBar:
